---
title: 网卡与网络栈
date: 2024-04-14 18:24:48
tags: ["linux", "内核", "网络"]
categories: ["内核"]
---

# 前言

偶然看到了**arthurchiao**大佬写的[Linux 网络栈接收数据（RX）：原理及内核实现（2022）](https://arthurchiao.art/blog/linux-net-stack-implementation-rx-zh/)文章，从中学习到了许多中断子系统和网络子系统的知识，收获颇丰，特别记录一下。

# 数据包处理流程

下图是一个数据包从网卡通过内核网络栈到达用户空间的流程
![数据包处理流程](数据包处理流程.png)

1. 网卡通过**DMA**写入数据到设备驱动预留的**ring buffer**中
2. 网卡产生**IRQ**硬件中断
3. 软中断处理线程**ksoftirq**基于**ring buffer**生成内核协议栈的数据包**skb**
4. 内核链路层协议栈处理
5. 内核网络层协议栈处理
6. 内核传输层协议栈处理

# 参考

- [Linux 网络栈接收数据（RX）：原理及内核实现（2022）](https://arthurchiao.art/blog/linux-net-stack-implementation-rx-zh/)
- [Linux 内核网络栈](https://nxw.name/2022/linux-network-stack)
